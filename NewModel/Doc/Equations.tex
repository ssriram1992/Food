%!TEX spellcheck
\documentclass[one column,a4paper]{article}
\usepackage{amsmath,amssymb,amsthm,xcolor,soul,enumerate,fullpage,mathrsfs,graphicx}
\allowdisplaybreaks

\def \mytitle {Food Model - Documentation}


\theoremstyle{definition}

\DeclareMathOperator* {\Max}{Maximize}
\DeclareMathOperator* {\Min}{Minimize}
\newcommand{\such}			{\intertext{such that }}

\newcommand{\I}[1]			{\scalebox{1.5}{1}_{#1}}

\definecolor{dgreen}{HTML}{00CC00}


\newcommand{\DiscFact}		{\mathsf{df}_y}
\newcommand{\Cost}			{\mathscr{C}}
\newcommand{\Area}			{\mathbf{A}}
\newcommand{\pr}			{\pi}
\newcommand{\Q}				{\mathbf{Q}}

% \renewcommand{\P}						{P}
% \renewcommand{\L}						{L}
\newcommand{\Y}			{Y}
\newcommand{\Se}		{H} % Seasons
\renewcommand{\S}		{W} % Storage
\newcommand{\D}			{D} % Distribution
\newcommand{\U}			{U} % Utility maximizer
\newcommand{\C}			{C} % Crops
\newcommand{\E}			{E} % Electricity
\newcommand{\F}			{F} % Food item
\newcommand{\M}			{M} % Milk
\newcommand{\R}			{R} % Road
\newcommand{\B}			{B} % Beef
\renewcommand{\H}		{H} % Hide
\newcommand{\N}			{N} % Nodes

\newcommand{\cow}			{\mathcal{B}}
\newcommand{\Yld}			{\mathcal{Y}_{yhnf}}
\newcommand{\YldH}			{\mathcal{Y}^{\H}}

\newcommand{\CAP}			{\textcolor{black} {\text{CAP}}}
\newcommand{\RCap}			{\textcolor{black} {\Q_{yrf}^{\R,\CAP}}}
\newcommand{\SCap}			{\textcolor{black} {\Q_{ynf}^{\S,\CAP}}}

\newcommand{\QFf}			{\textcolor{blue} {\Q^{\F}_{yhnf}}}
\newcommand{\QH}			{\textcolor{blue} {\Q^{\H}_{yhn}}}
\newcommand{\QDr}			{\textcolor{blue} {\Q^{\D}_{yhrf}}}
\newcommand{\QDbf}			{\textcolor{blue} {\Q^{\D_b}_{yhnf}}}
\newcommand{\QDsf}			{\textcolor{blue} {\Q^{\D_s}_{yhnf}}}
\newcommand{\QSf}[1][yh]	{\textcolor{blue} {\Q^{\S}_{#1nf}}}
\newcommand{\QSfbuy}		{\textcolor{blue} {\Q^{\S_b}_{yhnf}}}
\newcommand{\QSfsel}		{\textcolor{blue} {\Q^{\S_s}_{yhnf}}}
\newcommand{\QUf}			{\textcolor{blue} {\Q^{\U}_{yhnf}}}
\newcommand{\QE}			{\textcolor{blue} {\Q^{\E-gen}_{yhn}}}
\newcommand{\QEDem}			{\textcolor{blue} {\Q^{\E-dem}_{yhn}}}
\newcommand{\QEr}			{\textcolor{blue} {\Q^{\E}_{yhr}}}


\newcommand{\Qcow}[1][yh]		{\textcolor{blue} {\cow_{#1n}}}
\newcommand{\Qcowsl}			{\textcolor{blue}{\cow_{yhn}^{\text{slg}}}}
\newcommand{\Qcowbuy}[1][in]	{\textcolor{blue} {\cow_{yh#1}^{\text{buy}}}}
\newcommand{\picow}[1][yhn]		{\textcolor{dgreen}{\pr^{\text{cow}}_{#1}}}
\newcommand{\CowDeath}			{{\kappa^{\text{death}}_{yhn}}}
\newcommand{\Herdsize}			{\textcolor{black} {\cow_{n}^{\text{herd}}}}

\newcommand{\QEmin}				{\textcolor{black} {\underline{\Q}^{\E}_{yhn}}}
\newcommand{\QEmax}				{\textcolor{black} {\overline{\Q}^{\E}_{yhn}}}
\newcommand{\QErmax}			{\textcolor{black} {\overline{\Q}^{\E}_{yhr}}}


\newcommand{\piF}				{\textcolor{dgreen} {\pr^{\F}_{yhnf}}}
\newcommand{\piS}				{\textcolor{dgreen} {\pr^{\S}_{yhnf}}}
\newcommand{\piU}[1][f]			{\textcolor{dgreen} {\pr^{\U}_{yhn#1}}}
\newcommand{\piH}				{\textcolor{dgreen} {p^{\H}_{yhn}}}


\newcommand{\CsF}				{\textcolor{red} {\Cost^{\F}_{yhnf}}}
\newcommand{\CsR}				{\textcolor{red} {\Cost^{\R}_{yhrf}}}
\newcommand{\CsConv}[1][yh]		{\textcolor{red} {\Cost^{\text{conv}}_{#1n}}}
\newcommand{\CsChg}[1][yh]		{\textcolor{red} {\Cost^{\text{change}}_{#1n}}}
\newcommand{\CsCow}				{\textcolor{red} {\Cost^{\text{cow}}_{yhn} }}
\newcommand{\Cscowtrans}[1][i]	{\textcolor{red}{\Cost^{\text{cow,trans}}_{yh#1n}}}
\newcommand{\CsSq}				{\textcolor{red} {\Cost^{\S q}_{yhnf}}}
\newcommand{\CsSl}				{\textcolor{red} {\Cost^{\S l}_{yhnf}}}
\newcommand{\CsEl}				{\textcolor{red} {\Cost^{\E l}_{yhn}}}
\newcommand{\CsEq}				{\textcolor{red} {\Cost^{\E q}_{yhn}}}
\newcommand{\CsER}				{\textcolor{red} {\Cost^{\E \R}_{yhr}}}

\newcommand{\AF}[1][yhnf]		{\textcolor{cyan}{\Area^{\F}_{{#1}}}}
\newcommand{\An}				{\textcolor{cyan} {\Area_n}}

% Losses
\newcommand{\Loss}				{\textcolor{cyan} {\mathscr{L}}}
\newcommand{\LEr}				{\textcolor{cyan} {\Loss^{\E}_{yhr}}}

\newcommand{\DemInt}			{{\alpha_{yhnf}}}
\newcommand{\DemSlope}			{{\beta_{yhnf}}}
\newcommand{\DemCross}			{{\chi_{yhnfi}}}


\newcommand{\CYF}			{\textcolor{red} {\mathsf{CYF}}}
\newcommand{\elasticity}	{\textcolor{red} {\mathsf{e}}}
\newcommand{\aInCYF}		{\textcolor{red} {\mathsf{a}}}
\newcommand{\YieldBoost}	{\textcolor{dgreen} {\Yld^{\text{Inc}}}}

\numberwithin{equation}			{section}


\newcommand{\da}			{\textcolor{teal} {\delta^1_{yhn}}}
\newcommand{\db}			{\textcolor{teal} {\delta^2_{yhnf}}}
\newcommand{\dc}			{\textcolor{teal} {\delta^3_{yhn}}}
\newcommand{\dd}			{\textcolor{teal} {\delta^4_{yhn}}}
\newcommand{\de}			{\textcolor{teal} {\delta^5_{yhn}}}
\newcommand{\df}[1][n]		{\textcolor{teal} {\delta^6_{yh#1f}}}
\newcommand{\dg}			{\textcolor{teal} {\delta^7_{yhrf}}}
\renewcommand{\dh}			{\textcolor{teal} {\delta^8_{yhnf}}}
\newcommand{\di}			{\textcolor{teal} {\delta^9_{yhn}}}
\renewcommand{\dj}			{\textcolor{teal} {\delta^{10}_{yhn}}}
\newcommand{\dk}			{\textcolor{teal} {\delta^{\OFal}_{yn}}}
\newcommand{\dl}[1][ff']	{\textcolor{teal} {\delta^{\OCr}_{yn#1}}}
\newcommand{\dm}[1][yh]		{\textcolor{teal} {\delta^{11}_{#1nf}}}
% \newcommand{\dn}			{\textcolor{teal} {\delta^{12}_{yhnf}}}


% Settings Information
\newcommand{\Opt}			{\textcolor{orange} {\mathscr{O}}}
\newcommand{\OCr}			{{}_{\text{Rot}}\Opt}
\newcommand{\OCrDur}[1][ff']{\OCr_{#1}^\text{Dur}}
\newcommand{\OFal}			{{}_{\text{Fal}}\Opt}
\newcommand{\OFalDur}		{\OFal^{\text{Dur}}}





%% Heading information
\title{\mytitle}
\date{}
\author{Sriram Sankaranarayanan\and Ying Zhang\and Sauleh Siddiqui}

\begin{document}
\maketitle
\section{Crop Producer} % (fold)
The crop producer makes decisions on the land allotted for various crops. He has an ``expectation'' for the price of crops and their yield.
\subsection{Problem} % (fold)
\begin{align}
\Max \quad &: \quad  \sum_{\substack{y\in\Y\\h\in\Se}} \DiscFact \left \{ \sum_{f\in \C}\left (
	{\piF}{\QFf} - \CsF\AF - \frac{1}{2}\CsChg \left( \AF - \AF[(y-1)snf] \right)^2
 \right)\right .\nonumber\\
 \quad &\quad \quad \qquad \qquad \left .- \CsConv  \sum_{f\in \C} \left(\AF - \AF[(y-1)snf]\right) \right \}
\end{align} 
such that for $f\in \C$
\begin{subequations}
	\begin{align}
\QFf,\,\AF \quad &\geq \quad 0\\
\intertext{Total area used for crops is less than land available:}
\An \quad &\geq \quad  \sum_{\substack{f\in\C\\h\in\Se}}\AF & (\da)\\
\intertext{Total Quantity is yield times area for that crop, both in real terms and expected terms:}
\QFf \quad &\leq \quad \Yld\AF &(\db)\\
\intertext{Linking yield with climate yield factor:}
\Yld \quad &= \quad \aInCYF\CYF \left( \piF \right)  ^{\elasticity}%\left( 1+\YieldBoost \right) \\
&(\Yld)
\intertext{Fallow constraint where $\OFal$ is a number between 0 and 1 indicating the fraction of land that gets fallowed. $\OFalDur$ is the duration of fallow cycle:}
\sum_{\substack{f\in\C\\h\in\Se}}\sum_{y'=y}^{y+\OFalDur}\AF[y'snf] \quad &\leq \quad {\OFalDur}\An - \OFal\An&(\dk)\\
\intertext{Crop rotation constraint where $f$ is the primary crop rotated with $f'$:}
\OCr\sum_{y'=y}^{y+\OCrDur}\sum_{h\in\Se}\AF[y'snf] \quad &\leq \quad \OCrDur\sum_{y'=y}^{y+\OCrDur}\sum_{h\in\Se}\AF[y'snf']&(\dl)
\end{align} 
\end{subequations}
\subsection{KKT Conditions} % (fold)
These KKT conditions hold for $f\in \C$
\begin{subequations}
\begin{align}
\db - \DiscFact\piF \quad &\geq \quad 0&(\QFf)\\
\left .
\begin{aligned}
	  \da+\DiscFact \left( \CsF+\CsConv[y] - \CsConv[(y+1)] + \CsChg\AF + \CsChg[(y+1)]\AF \right)  \\
	-\db\Yld  - \DiscFact\left( \CsChg\AF[(y-1)nf] + \CsChg[(y+1)]\AF[(y+1)nf]  \right) \\
	+\OFal\sum_{\substack{y'=y-\OCrDur}}^y\dk \\
	\pm\OCr \sum_{\substack{y'=y-\OFalDur}}^y\dl 
\end{aligned}
\right \} \quad &\geq \quad 0 &(\AF)
\end{align} 	
where the sign of the last term depends upon whether $f$ is the main crop or the secondary crop used for rotation.
\end{subequations}
% \pagebreak




\section{Livestock producer} % (fold)
\subsection{Problem} % (fold)
\begin{align}
\Max \quad &: \quad \sum_{\substack{y\in Y\\h\in\Se\\ f\not\in \C}} \DiscFact \left( 
\piF\QFf + \piH \QH - \sum_{i\in \N} (\Cscowtrans + \picow[yhi])\Qcowbuy - \Qcow\CsCow
 \right) 
\end{align} 
such that for $f\not\in \C$
\begin{subequations}
	\begin{align}
\Qcowbuy,\, \Qcow,\,  \Qcowsl \quad &\geq \quad 0\\
\QFf,\, \QH \quad &\geq \quad 0\\
\QFf \quad &\leq \quad \Yld\Qcow \qquad \qquad(f=\text{Milk})&(\db)\nonumber\\
\QFf \quad &\leq \quad \Yld\Qcowsl \qquad \qquad(f=\text{Beef})&(\db)\nonumber\\
\QH \quad &\leq \quad \YldH\Qcowsl&(\dc)\\
\Qcowsl \quad &\leq \quad \Qcow&(\dd)\\
\Qcow \quad &\leq \quad (1+k-\kappa)\Qcow[(y-1)h] - \Qcowsl + \sum_{i\in\N}\left( \Qcowbuy - \Qcowbuy[ni] \right) &(\picow[yn])\\
\Qcowsl \quad &\geq \quad \CowDeath\Qcow&({\di})\\
\Qcow \quad &\geq \quad \Herdsize&(\dj)
\end{align} 
\end{subequations}
\subsection{KKT Conditions} % (fold)
\begin{subequations}
\begin{align}
 \left .
\begin{aligned}
\DiscFact\CsCow - \db\Yld-\dd + \CowDeath\di &\\	
- \dj+\picow[yhn] - (1+k-\kappa)\picow[(y+1)hn] &
\end{aligned} \right \}
\quad &\geq \quad 0
\qquad (f=\text{Milk})&(\Qcow)\\
\DiscFact\left( \Cscowtrans+\picow[yhi] \right)  +\left( \picow[yhi]-\picow \right)
\quad &\geq \quad 0&(\Qcowbuy)\\
\db-\DiscFact\piF  \quad &\geq \quad 0 &(\QFf) \nonumber\\
\dc-\DiscFact\piH\quad &\geq \quad 0&(\QH)\\
\dd-\dj-\db\Yld - \dc\YldH +\picow \quad &\geq \quad 0 \qquad (f=\text{Beef})&(\Qcowsl)
\end{align} 
\end{subequations}
% \pagebreak


\section{Distribution} 
\subsection{Problem} 
\begin{align}
\Max \quad &: \quad \sum_{\substack{y\in \Y\\h\in\Se\\ f\in\F}} \DiscFact \left\{ 
	\sum_{n\in \N}\left( 
		 \QDsf\piS - \QDbf\piF 
	 \right) - \sum_{r\in \R}\CsR\QDr
 \right\}
\end{align}
such that
\begin{subequations}
	\begin{align}
\QDbf,\, \QDr,\, \QDsf \quad &\geq \quad 0\\
\QDbf+ \sum_{r\in \R_{\text{in}}} \QDr \quad &\geq \quad \QDsf + \sum_{r\in \R_{\text{out}}} \QDr&(\df)\\
\QDr \quad &\leq \quad \RCap&(\dg)
\end{align} 
\end{subequations}
\subsection{KKT Conditions} 
Representing $s_r$ and $d_r$ as the source and destination nodes of the transport system $r\in\R$, we have the following KKT conditions.
\begin{subequations}
\begin{align}
\DiscFact \piF -\df \quad &\geq \quad 0 &(\QDbf)  \\
\dg+\DiscFact\CsR + \df[s_r] - \df[d_r]  \quad &\geq \quad 0&(\QDr) 	\\
\df-\DiscFact \piS \quad &\geq \quad 0&(\QDsf)
\end{align}
\end{subequations}
% \pagebreak





\section{Storage} 
\subsection{Problem} 
\begin{align}
\Max \quad &: \quad \sum_{\substack{y\in\Y\\h\in\Se\\ f\in \F}}  \piU\QSfsel-\piS\QSfbuy -\left( \frac{1}{2}\CsSq\QSf  + \CsSl \right)  \QSf  
\end{align} 
such that
\begin{subequations}
	\begin{align}
\QSfbuy,\,\QSfsel,\,\QSf \quad &\geq \quad 0\\
\QSf \quad &\leq \quad \SCap&(\dh)\\
\intertext{For the first season $h$, if $h'$ is the last season}
\QSf \quad &= \quad \QSf[(y-1)h'] + \QSfbuy-\QSfsel&(\dm)
\intertext{For other seasons}
\QSf \quad &= \quad \QSf[y(h-1)] + \QSfbuy-\QSfsel&(\dm)
\end{align} 
\end{subequations}
\subsection{KKT Conditions} 
\begin{subequations}
\begin{align}
\piS-\dm \quad &\geq \quad 0&(\QSfbuy)\\
\dm-\piU \quad &\geq \quad 0&(\QSfsel)
\intertext{For last season $h$, where $h'$ is the first season}
\CsSq\QSf + \CsSl +\dh +\dm -\dm[(y+1)h'] \quad &\geq \quad 0&(\QSf) 
\intertext{For other seasons}
\CsSq\QSf + \CsSl +\dh +\dm -\dm[y(h+1)] \quad &\geq \quad 0&(\QSf) 
\end{align} 
\end{subequations}
% \pagebreak




\section{Market Clearing} 
\begin{subequations}
\begin{align}
\QFf \quad &= \quad  \QDbf&(\piF)\\
\piU \quad &= \quad \DemInt - \DemSlope\QSf + \sum_{i\in\F}\DemCross \piU[i]&(\piU)\\
\QSfbuy \quad &= \quad \QDsf&(\piS)
\end{align} 
\end{subequations}



\section{Electricity}
\subsection{Problem} 
We model electricity with a single operator. A subset of nodes can have production facilities. The production facilities have a minimum and maximum production capabilities. All nodes are connected by transmission lines, with a cost of transmission along each line. They have transmission capacities too. There is currently no possibility of expansion. The cost is minimized in the model. 
\begin{align}
	\Min \quad &: \quad  \sum_{\substack{y\in\Y\\n\in\N}} \left( \CsEl\QE+\frac{1}{2}\CsEq\QE^2 \right) + \sum_{\substack{y\in\Y\\ r\in\R}}\CsER\QEr
\end{align}
such that
\begin{subequations}
\begin{align}
\QE \quad &\geq \quad 0\\
\intertext{Generator limits}
\QE \quad &\geq \quad \QEmin\\
\QE \quad &\leq \quad \QEmax\\
\intertext{The Kirchoff Current Law in each node. This also ensures that the demand is met in each node. $\LEr$ is the transmission loss.}
\QE+ \sum_{r\in \R_{\text{in}}} \QEr \left( 1-\LEr \right)  \quad &\geq \quad \QEDem + \sum_{r\in \R_{\text{out}}} \QEr\\
\intertext{Transmission capacity}
\QEr \quad &\leq \quad \QErmax
\end{align} 
\end{subequations}
\end{document}
